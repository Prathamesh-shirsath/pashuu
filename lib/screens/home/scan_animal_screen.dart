// lib/screens/home/scan_animal_screen.dart

import 'dart:io';
import 'dart:convert';

import 'package:flutter/material.dart';
import 'package:image_picker/image_picker.dart';
import 'package:tflite_flutter/tflite_flutter.dart';
import 'package:image/image.dart' as img;
import 'package:firebase_auth/firebase_auth.dart';
import 'package:cloud_firestore/cloud_firestore.dart';

class ScanAnimalScreen extends StatefulWidget {
  const ScanAnimalScreen({super.key});

  @override
  State<ScanAnimalScreen> createState() => _ScanAnimalScreenState();
}

class _ScanAnimalScreenState extends State<ScanAnimalScreen> {
  File? _image;
  List<double>? _output;
  Interpreter? _interpreter;
  bool _loading = true;
  List<String>? _labels;

  /// ЁЯФ╣ Minimum confidence threshold тАУ isse kam hoga to hum result reject karenge
  static const double _confidenceThreshold = 0.30; // 60%

  // ЁЯФ╣ Breed information map (keys must match your labels.txt logically)
  static const Map<String, String> _breedInfo = {
    "Alambadi":
    "ЁЯРД рдЕрд▓рдордмрд╛рдбрд╝реА рдЧрд╛рдп\nтАв рдореБрдЦреНрдп рдХреНрд╖реЗрддреНрд░: рддрдорд┐рд▓рдирд╛рдбреБ (рдзрд░реНрдордкреБрд░реА, рд╕рд▓реЗрдо, рдХреГрд╖реНрдгрдЧрд┐рд░рд┐)\nтАв рдЙрдкрдпреЛрдЧ: рдмреИрд▓ рд╢рдХреНрддрд┐ рдФрд░ рдЦреЗрддреА рдХреЗ рд▓рд┐рдП, рд╕реАрдорд┐рдд рджреБрдЧреНрдз рдЙрддреНрдкрд╛рджрдиред\nтАв рд╡рд┐рд╢реЗрд╖рддрд╛: рдордЬрдмреВрдд рд╢рд░реАрд░, рдЧрд░реНрдо рдЬрд▓рд╡рд╛рдпреБ рд╕рд╣рдирд╢реАрд▓, рд░реЛрдЧреЛрдВ рд╕реЗ рдЕрдЪреНрдЫреА рдкреНрд░рддрд┐рд░реЛрдзрдХ рдХреНрд╖рдорддрд╛ред",
    "Amritmahal":
    "ЁЯРД рдЕрдореГрддрдорд╣рд▓ рдЧрд╛рдп\nтАв рдореБрдЦреНрдп рдХреНрд╖реЗрддреНрд░: рдХрд░реНрдирд╛рдЯрдХ (рдЪрд┐рддреНрд░рджреБрд░реНрдЧ, рддреБрдордХреБрд░, рд╣рд╛рд╕рди)\nтАв рдЙрдкрдпреЛрдЧ: рдЙрддреНрдХреГрд╖реНрдЯ рдмреИрд▓ рд╢рдХреНрддрд┐, рд╣рд▓ рдФрд░ рдЧрд╛рдбрд╝реА рдХреЗ рд▓рд┐рдП рдкреНрд░рд╕рд┐рджреНрдзред\nтАв рд╡рд┐рд╢реЗрд╖рддрд╛: рдордЬрдмреВрдд, рд╕рд╣рдирд╢реАрд▓, рд▓рдВрдмреА рджреВрд░реА рддрдХ рдХрд╛рдо рдХрд░рдиреЗ рдХреА рдХреНрд╖рдорддрд╛, рджреВрдз рдордзреНрдпрдо рдорд╛рддреНрд░рд╛ рдореЗрдВред",
    "Ayrshire":
    "ЁЯРД рдПрдпрд░реНрд╢рд╛рдпрд░ рдЧрд╛рдп (рд╡рд┐рджреЗрд╢реА)\nтАв рдореВрд▓: рд╕реНрдХреЙрдЯрд▓реИрдВрдб\nтАв рдЙрдкрдпреЛрдЧ: рдЕрдЪреНрдЫреА рджреБрдЧреНрдз рдЙрддреНрдкрд╛рджрди рд╡рд╛рд▓реА рд╡рд┐рджреЗрд╢реА рдирд╕реНрд▓ред\nтАв рд╡рд┐рд╢реЗрд╖рддрд╛: рд▓рд╛рд▓-рд╕рдлреЗрдж рдзрдмреНрдмреЗ, рдордзреНрдпрдо рдЖрдХрд╛рд░, рдЙрдЪреНрдЪ рдЙрддреНрдкрд╛рджрди рд▓реЗрдХрд┐рди рдЧрд░реНрдореА рдореЗрдВ рдереЛрдбрд╝реА рд╕рдВрд╡реЗрджрдирд╢реАрд▓ред",
    "Banni":
    "ЁЯРД рдмрдиреНрдиреА рдЧрд╛рдп\nтАв рдореБрдЦреНрдп рдХреНрд╖реЗрддреНрд░: рдЧреБрдЬрд░рд╛рдд рдХрд╛ рдХрдЪреНрдЫ рдХреНрд╖реЗрддреНрд░ (рдмрдиреНрдиреА рдШрд╛рд╕рднреВрдорд┐)\nтАв рдЙрдкрдпреЛрдЧ: A2 рджреВрдз, рдХрдареЛрд░ рдкрд░рд┐рд╕реНрдерд┐рддрд┐рдпреЛрдВ рдореЗрдВ рднреА рдЕрдЪреНрдЫрд╛ рдкреНрд░рджрд░реНрд╢рдиред\nтАв рд╡рд┐рд╢реЗрд╖рддрд╛: рдЫреЛрдЯреЗ-рдордзреНрдпрдо рдЖрдХрд╛рд░ рдХреА, рдКрдБрдЯ рдЬреИрд╕реЗ рд╕рд╣рдирд╢реАрд▓, рд▓рдВрдмреА рджреВрд░реА рддрдХ рдЪрд░ рд╕рдХрддреА рд╣реИред",
    "Bargur":
    "ЁЯРД рдмрд╛рд░рдЧреБрд░ рдЧрд╛рдп\nтАв рдореБрдЦреНрдп рдХреНрд╖реЗрддреНрд░: рддрдорд┐рд▓рдирд╛рдбреБ (рдИрд░реЛрдб рдЬрд┐рд▓рд╛, рдмрд╛рд░рдЧреБрд░ рдкрд╣рд╛рдбрд╝реА рдХреНрд╖реЗрддреНрд░)\nтАв рдЙрдкрдпреЛрдЧ: рдкрд╣рд╛рдбрд╝реА рдХреНрд╖реЗрддреНрд░реЛрдВ рдореЗрдВ рдмреИрд▓ рд╢рдХреНрддрд┐ рдФрд░ рд╕реАрдорд┐рдд рджреВрдзред\nтАв рд╡рд┐рд╢реЗрд╖рддрд╛: рддреЗрдЬ, рдлреБрд░реНрддреАрд▓реА, рд▓рд╛рд▓/рднреВрд░реЗ рд░рдВрдЧ рдкрд░ рд╕рдлреЗрдж рдЪрд┐рддреНрддреА, рдкрд╣рд╛рдбрд╝реА рдЪрд░рд╛рдИ рдХреЗ рд▓рд┐рдП рдЙрдкрдпреБрдХреНрддред",
    "Bhadawari":
    "ЁЯРГ рднрджрд╛рд╡рд░реА рднреИрдВрд╕\nтАв рдореБрдЦреНрдп рдХреНрд╖реЗрддреНрд░: рдЙрддреНрддрд░ рдкреНрд░рджреЗрд╢ (рдЗрдЯрд╛рд╡рд╛, рдФрд░реИрдпрд╛) рд╡ рдордзреНрдп рдкреНрд░рджреЗрд╢ рд╕реАрдорд╛рд╡рд░реНрддреА рдХреНрд╖реЗрддреНрд░ред\nтАв рдЙрдкрдпреЛрдЧ: рдЙрдЪреНрдЪ рдлреИрдЯ рд╡рд╛рд▓рд╛ рджреВрдз (7тАУ8% рдпрд╛ рдЕрдзрд┐рдХ)ред\nтАв рд╡рд┐рд╢реЗрд╖рддрд╛: рддрд╛рдВрдмреЗ рдЬреИрд╕реА рдЪрдордбрд╝реА, рдордЬрдмреВрдд рд╢рд░реАрд░, рдХрдо рдЪрд╛рд░реЗ рдореЗрдВ рднреА рдЕрдЪреНрдЫрд╛ рджреВрдзред",
    "Brown_Swiss":
    "ЁЯРД рдмреНрд░рд╛рдЙрди рд╕реНрд╡рд┐рд╕ рдЧрд╛рдп (рд╡рд┐рджреЗрд╢реА)\nтАв рдореВрд▓: рд╕реНрд╡рд┐рдЯреНрдЬрд╝рд░рд▓реИрдВрдб\nтАв рдЙрдкрдпреЛрдЧ: рдЙрдЪреНрдЪ рджреБрдЧреНрдз рдЙрддреНрдкрд╛рджрди, рд╡рд┐рд╢реНрд╡ рдкреНрд░рд╕рд┐рджреНрдз рдбреЗрдпрд░реА рдирд╕реНрд▓ред\nтАв рд╡рд┐рд╢реЗрд╖рддрд╛: рднреВрд░рд╛ рд░рдВрдЧ, рдордЬрдмреВрдд рдкреИрд░, рдардВрдбреЗ рдХреНрд╖реЗрддреНрд░реЛрдВ рдХреЗ рд▓рд┐рдП рдЕрдзрд┐рдХ рдЙрдкрдпреБрдХреНрддред",
    "Dangi":
    "ЁЯРД рдбрд╛рдВрдЧреА рдЧрд╛рдп\nтАв рдореБрдЦреНрдп рдХреНрд╖реЗрддреНрд░: рдорд╣рд╛рд░рд╛рд╖реНрдЯреНрд░ (рдирд╛рд╕рд┐рдХ, рдард╛рдгреЗ, рдкрд╛рд▓рдШрд░) рдФрд░ рдЧреБрдЬрд░рд╛рдд рдХреА рдкрд╣рд╛рдбрд╝реА/рдмрд░рд╕рд╛рддреА рдкрдЯреНрдЯреАред\nтАв рдЙрдкрдпреЛрдЧ: рдЦреЗрддреА, рдмреИрд▓рдЧрд╛рдбрд╝реА рдФрд░ рдордзреНрдпрдо рджреВрдзред\nтАв рд╡рд┐рд╢реЗрд╖рддрд╛: рднрд╛рд░реА рд╡рд░реНрд╖рд╛ рд╡ рдХреАрдЪрдбрд╝ рд╡рд╛рд▓реА рдЬрдореАрди рдореЗрдВ рдХрд╛рдо рдХрд░рдиреЗ рдХреА рдЕрджреНрднреБрдд рдХреНрд╖рдорддрд╛, рд╕рдлреЗрдж/рдзреВрд╕рд░ рд░рдВрдЧ рдкрд░ рдЪрд┐рддреНрддреАред",
    "Deoni":
    "ЁЯРД рджреЗрд╡рдиреА (Deoni) рдЧрд╛рдп\nтАв рдореБрдЦреНрдп рдХреНрд╖реЗрддреНрд░: рдорд╣рд╛рд░рд╛рд╖реНрдЯреНрд░ (рд▓рд╛рддреВрд░, рдирд╛рдВрджреЗрдбрд╝) рд╡ рдХрд░реНрдирд╛рдЯрдХ рд╕реАрдорд╛ рдХреНрд╖реЗрддреНрд░ред\nтАв рдЙрдкрдпреЛрдЧ: рджреЛрд╣рд░реЗ рдЙрджреНрджреЗрд╢реНрдп тАУ рджреВрдз рдФрд░ рдмреИрд▓ рд╢рдХреНрддрд┐ред\nтАв рд╡рд┐рд╢реЗрд╖рддрд╛: рдХрд╛рд▓рд╛ рдФрд░ рд╕рдлреЗрдж рд░рдВрдЧ, рдордЬрдмреВрдд рд╢рд░реАрд░, рдЕрдЪреНрдЫреЗ рджреВрдз рдХреЗ рд╕рд╛рде рд╕реНрдерд╛рдиреАрдп рдкрд░рд┐рд╕реНрдерд┐рддрд┐рдпреЛрдВ рдореЗрдВ рдЕрдиреБрдХреВрд▓ред",
    "Gir":
    "ЁЯРД рдЧрд┐рд░ рдЧрд╛рдп тАУ рдкреВрд░реА рдЬрд╛рдирдХрд╛рд░реА\nтАв рдореБрдЦреНрдп рдХреНрд╖реЗрддреНрд░: рдЧреБрдЬрд░рд╛рдд (рдЧрд┐рд░ рдЬрдВрдЧрд▓, рдЬреВрдирд╛рдЧрдврд╝, рдЕрдорд░реЗрд▓реА, рднрд╛рд╡рдирдЧрд░, рд░рд╛рдЬрдХреЛрдЯ)\nтАв рдЕрдиреНрдп рд░рд╛рдЬреНрдп: рдорд╣рд╛рд░рд╛рд╖реНрдЯреНрд░, рд░рд╛рдЬрд╕реНрдерд╛рди, рдХрд░реНрдирд╛рдЯрдХ, рдЖрдВрдзреНрд░ рдкреНрд░рджреЗрд╢; рд╡рд┐рджреЗрд╢ рдореЗрдВ рдмреНрд░рд╛рдЬрд╝реАрд▓ рдореЗрдВ рдмрд╣реБрдд рдкреНрд░рд╕рд┐рджреНрдзред\nтАв рджреВрдз рдЙрддреНрдкрд╛рджрди: рдФрд╕рдд 10тАУ15 рд▓реАрдЯрд░/рджрд┐рди, рдЕрдЪреНрдЫреА рджреЗрдЦрднрд╛рд▓ рдкрд░ 18тАУ25 рд▓реАрдЯрд░/рджрд┐рди, A2 рджреВрдз, рдлреИрдЯ 4.5тАУ5.5%.\nтАв рдЪрд╛рд░рд╛: рд╣рд░рд╛ рдЪрд╛рд░рд╛ (рдордХреНрдХрд╛, рдЬреНрд╡рд╛рд░, рдмрд╛рдЬрд░рд╛, рдиреЗрдкрд┐рдпрд░), рд╕реВрдЦрд╛ рдЪрд╛рд░рд╛ (рднреВрд╕рд╛, рдЦрд▓реА), рдХрдВрд╕рдиреНрдЯреНрд░реЗрдЯ рд╡ рдорд┐рдирд░рд▓ рдорд┐рдХреНрд╕; 40тАУ60 рд▓реАрдЯрд░ рдкрд╛рдиреА/рджрд┐рдиред\nтАв рд╡рд┐рд╢реЗрд╖рддрд╛: рд▓рд╛рд▓/рдЧреЗрд░реБрдЖ рд░рдВрдЧ, рд▓рдВрдмреЗ рд▓рдЯрдХрддреЗ рдХрд╛рди, рдЙрднрд░рд╛ рдорд╛рдерд╛, рдордЬрдмреВрдд рдХреБрдмрдбрд╝, рдЧрд░реНрдореА рд╡ рд░реЛрдЧреЛрдВ рдХреЗ рдкреНрд░рддрд┐ рдЕрдЪреНрдЫреА рд╕рд╣рдирд╢реАрд▓рддрд╛, рд╢рд╛рдВрдд рд╕реНрд╡рднрд╛рд╡, 15тАУ20 рд╕рд╛рд▓ рддрдХ рдЖрдпреБред",
    "Guernsey":
    "ЁЯРД рдЧреЙрд░реНрдирд╕реА рдЧрд╛рдп (рд╡рд┐рджреЗрд╢реА)\nтАв рдореВрд▓: рдЗрдВрдЧреНрд▓реИрдВрдб рдХреЗ рдЪреИрдирд▓ рдЖрдЗрд▓реИрдВрдб\nтАв рдЙрдкрдпреЛрдЧ: рдЙрдЪреНрдЪ рдлреИрдЯ рд╡рд╛рд▓рд╛ рджреВрдзред\nтАв рд╡рд┐рд╢реЗрд╖рддрд╛: рд╣рд▓реНрдХрд╛ рднреВрд░рд╛-рдкреАрд▓рд╛ рд░рдВрдЧ, рджреВрдз рдХрд╛ рд░рдВрдЧ рдереЛрдбрд╝рд╛ рдкреАрд▓рд╛, рдардВрдбреЗ рд╡ рдордзреНрдпрдо рдореМрд╕рдо рдХреЗ рд▓рд┐рдП рдмреЗрд╣рддрд░ред",
    "Hallikar":
    "ЁЯРД рд╣рд▓реНрд▓рд┐рдХрд░ рдЧрд╛рдп\nтАв рдореБрдЦреНрдп рдХреНрд╖реЗрддреНрд░: рдХрд░реНрдирд╛рдЯрдХ (рдореИрд╕реВрд░ рд╡ рдЖрд╕-рдкрд╛рд╕)\nтАв рдЙрдкрдпреЛрдЧ: рдХрдард┐рди рдХреГрд╖рд┐ рдХрд╛рд░реНрдп рд╡ рдмреИрд▓рдЧрд╛рдбрд╝реА рдХреЗ рд▓рд┐рдП рдкреНрд░рд╕рд┐рджреНрдзред\nтАв рд╡рд┐рд╢реЗрд╖рддрд╛: рдкрддрд▓рд╛ рд▓реЗрдХрд┐рди рдордЬрдмреВрдд рд╢рд░реАрд░, рд▓рдВрдмрд╛ рдЪреЗрд╣рд░рд╛, рддреЗрдЬ рдЪрд╛рд▓, рд▓рдВрдмреЗ рд╕рдордп рддрдХ рдХрд╛рдо рдХрд░рдиреЗ рдХреА рдХреНрд╖рдорддрд╛ред",
    "Hariana":
    "ЁЯРД рд╣рд░рд┐рдпрд╛рдгрд╛ рдЧрд╛рдп\nтАв рдореБрдЦреНрдп рдХреНрд╖реЗрддреНрд░: рд╣рд░рд┐рдпрд╛рдгрд╛, рдкрд╢реНрдЪрд┐рдореА рдЙрддреНрддрд░ рдкреНрд░рджреЗрд╢, рд░рд╛рдЬрд╕реНрдерд╛рди рд╕реАрдорд╛ред\nтАв рдЙрдкрдпреЛрдЧ: рджреЛрд╣рд░реЗ рдЙрджреНрджреЗрд╢реНрдп тАУ рдЦреЗрддреА рд╡ рджреВрдз рджреЛрдиреЛрдВред\nтАв рд╡рд┐рд╢реЗрд╖рддрд╛: рд╕рдлреЗрдж/рд╣рд▓реНрдХрд╛ рднреВрд░рд╛ рд░рдВрдЧ, рдордзреНрдпрдо рд╕реЗ рдЕрдЪреНрдЫрд╛ рджреВрдз рдЙрддреНрдкрд╛рджрди, рдЕрдиреБрдХреВрд▓рдиреАрдп рд╡ рдордЬрдмреВрддред",
    "Holstein_Friesian":
    "ЁЯРД рд╣реЛрд▓реНрд╕реНрдЯреАрди-рдлреНрд░рд┐рдЬрд╝рд┐рдпрди (HF) рдЧрд╛рдп\nтАв рдореВрд▓: рдиреАрджрд░рд▓реИрдВрдб/рдЬрд░реНрдордиреА рдХреНрд╖реЗрддреНрд░\nтАв рдЙрдкрдпреЛрдЧ: рдЕрддреНрдпрдзрд┐рдХ рджреБрдЧреНрдз рдЙрддреНрдкрд╛рджрди (рд╡рд┐рджреЗрд╢реА рдирд╕реНрд▓реЛрдВ рдореЗрдВ рдЯреЙрдк)ред\nтАв рд╡рд┐рд╢реЗрд╖рддрд╛: рдХрд╛рд▓рд╛-рд╕рдлреЗрдж рдмрдбрд╝реЗ рдзрдмреНрдмреЗ, рдмрд╣реБрдд рдЕрдзрд┐рдХ рджреВрдз рд▓реЗрдХрд┐рди рдЧрд░реНрдореА рд╡ рдЙрд╖реНрдгрдХрдЯрд┐рдмрдВрдзреАрдп рд░реЛрдЧреЛрдВ рдХреЗ рдкреНрд░рддрд┐ рд╕рдВрд╡реЗрджрдирд╢реАрд▓ред",
    "Jaffrabadi":
    "ЁЯРГ рдЬрд╛рдлрд░рд╛рдмрд╛рджреА рднреИрдВрд╕\nтАв рдореБрдЦреНрдп рдХреНрд╖реЗрддреНрд░: рдЧреБрдЬрд░рд╛рдд (рдЬреБрдирд╛рдЧрдврд╝, рдЬрд╛рдлрд░рд╛рдмрд╛рдж рдХреНрд╖реЗрддреНрд░)\nтАв рдЙрдкрдпреЛрдЧ: рдЙрдЪреНрдЪ рджреВрдз рдЙрддреНрдкрд╛рджрди рдПрд╡рдВ рднрд╛рд░реА рдмреИрд▓ рд╢рдХреНрддрд┐ред\nтАв рд╡рд┐рд╢реЗрд╖рддрд╛: рдмрд╣реБрдд рдмрдбрд╝рд╛ рд╕рд┐рд░, рднрд╛рд░реА рд╕реАрдВрдЧ, рдЧрд╣рд░рд╛ рдХрд╛рд▓рд╛ рд░рдВрдЧ, рдордЬрдмреВрдд рдФрд░ рднрд╛рд░реА рд╢рд░реАрд░ред",
    "Jersey":
    "ЁЯРД рдЬрд░реНрд╕реА рдЧрд╛рдп\nтАв рдореВрд▓: рдЬрд░реНрд╕реА рджреНрд╡реАрдк (рдЗрдВрдЧреНрд▓реИрдВрдб)\nтАв рдЙрдкрдпреЛрдЧ: рдЙрдЪреНрдЪ рдлреИрдЯ рд╡рд╛рд▓рд╛ рджреВрдз, рдХреНрд░реЙрд╕рдмреНрд░реАрдб рдХреЗ рд░реВрдк рдореЗрдВ рдкреВрд░реЗ рднрд╛рд░рдд рдореЗрдВ рд▓реЛрдХрдкреНрд░рд┐рдпред\nтАв рд╡рд┐рд╢реЗрд╖рддрд╛: рд╣рд▓реНрдХрд╛ рднреВрд░реЗ рд╕реЗ рдЧреЗрд░реБрдЖ рд░рдВрдЧ, рдЫреЛрдЯреА-рдордзреНрдпрдо рдЖрдХрд╛рд░ рдХреА, рдЧрд░реНрдореА рдореЗрдВ HF рд╕реЗ рдереЛрдбрд╝реА рдЕрдзрд┐рдХ рд╕рд╣рдирд╢реАрд▓ред",
    "Kangayam":
    "ЁЯРД рдХрд╛рдВрдЧрд╛рдпрдо рдЧрд╛рдп\nтАв рдореБрдЦреНрдп рдХреНрд╖реЗрддреНрд░: рддрдорд┐рд▓рдирд╛рдбреБ (рдИрд░реЛрдб, рдХреЛрдпрдВрдмрддреВрд░ рдХреНрд╖реЗрддреНрд░)\nтАв рдЙрдкрдпреЛрдЧ: рдЙрддреНрдХреГрд╖реНрдЯ рдмреИрд▓ рд╢рдХреНрддрд┐ рд╡ рдЦреЗрддреАред\nтАв рд╡рд┐рд╢реЗрд╖рддрд╛: рдЧреНрд░реЗ рд╕реЗ рд╕рдлреЗрдж рд░рдВрдЧ, рд╕реАрдзрд╛ рд╢рд░реАрд░, рдордЬрдмреВрдд рдкреИрд░, рд▓рдВрдмреА рджреВрд░реА рддрдХ рдХрд╛рдо рдХрд░рдиреЗ рдХреА рдХреНрд╖рдорддрд╛ред",
    "Kankrej":
    "ЁЯРД рдХрд╛рдВрдХрд░реЗрдЬ рдЧрд╛рдп\nтАв рдореБрдЦреНрдп рдХреНрд╖реЗрддреНрд░: рдЧреБрдЬрд░рд╛рдд (рдХрдЪреНрдЫ, рдмрдирд╛рд╕рдХрд╛рдВрдард╛) рд╡ рд░рд╛рдЬрд╕реНрдерд╛рди рд╕реАрдорд╛ред\nтАв рдЙрдкрдпреЛрдЧ: рджреЛрд╣рд░реЗ рдЙрджреНрджреЗрд╢реНрдп тАУ рджреВрдз рд╡ рдмреИрд▓ рд╢рдХреНрддрд┐ред\nтАв рд╡рд┐рд╢реЗрд╖рддрд╛: рдЪрд╛рдВрджреА рдЬреИрд╕рд╛ рдЧреНрд░реЗ рд░рдВрдЧ, рд▓рд┐рд░рд╛-рдЖрдХрд╛рд░ рдХреЗ рд▓рдВрдмреЗ рд╕реАрдВрдЧ, рдЧрд░реНрдореА рд╡ рд╕реВрдЦреЗ рдХреНрд╖реЗрддреНрд░ рдореЗрдВ рднреА рдЕрдЪреНрдЫрд╛ рдкреНрд░рджрд░реНрд╢рдиред",
    "Kasargod":
    "ЁЯРД рдХрд╛рд╕рд░рдЧреЛрдб рдЧрд╛рдп\nтАв рдореБрдЦреНрдп рдХреНрд╖реЗрддреНрд░: рдХреЗрд░рд▓ (рдХрд╛рд╕рд░рдЧреЛрдб рдЬрд┐рд▓рд╛)\nтАв рдЙрдкрдпреЛрдЧ: рд╕реНрдерд╛рдиреАрдп рджреБрдЧреНрдз рдЙрддреНрдкрд╛рджрди рд╡ рд╣рд▓реНрдХреЗ рдХреГрд╖рд┐ рдХрд╛рд░реНрдпред\nтАв рд╡рд┐рд╢реЗрд╖рддрд╛: рдЫреЛрдЯреА-рдордзреНрдпрдо, рд╕реНрдерд╛рдиреАрдп рдЬрд▓рд╡рд╛рдпреБ рдореЗрдВ рдЕрдиреБрдХреВрд▓, рдХрдо рджреЗрдЦрднрд╛рд▓ рдореЗрдВ рдЬреАрд╡рд┐рдд рд░рд╣ рд╕рдХрддреА рд╣реИред",
    "Kenkatha":
    "ЁЯРД рдХреЗрдВрдХрд╛рдард╛ рдЧрд╛рдп\nтАв рдореБрдЦреНрдп рдХреНрд╖реЗрддреНрд░: рдЙрддреНрддрд░ рдкреНрд░рджреЗрд╢ рд╡ рдордзреНрдп рдкреНрд░рджреЗрд╢ рдХреА рдХреЗрди рд╡ рдмреЗрддрд╡рд╛ рдирджреА рдШрд╛рдЯреАред\nтАв рдЙрдкрдпреЛрдЧ: рдореБрдЦреНрдпрддрдГ рдмреИрд▓ рд╢рдХреНрддрд┐ рдПрд╡рдВ рд╣рд▓ рдХрд╛рд░реНрдпред\nтАв рд╡рд┐рд╢реЗрд╖рддрд╛: рдЫреЛрдЯрд╛ рд▓реЗрдХрд┐рди рдордЬрдмреВрдд рд╢рд░реАрд░, рдЧрд╣рд░рд╛ рднреВрд░рд╛/рдХрд╛рд▓рд╛ рд░рдВрдЧ, рдХрдареЛрд░ рдкрд░рд┐рд╕реНрдерд┐рддрд┐рдпреЛрдВ рдореЗрдВ рднреА рдХрд╛рдоред",
    "Kherigarh":
    "ЁЯРД рдЦреЗрд░реАрдЧрдврд╝ рдЧрд╛рдп\nтАв рдореБрдЦреНрдп рдХреНрд╖реЗрддреНрд░: рдЙрддреНрддрд░ рдкреНрд░рджреЗрд╢ (рдЦреАрд░реА, рд▓рдЦреАрдордкреБрд░ рдХреНрд╖реЗрддреНрд░)\nтАв рдЙрдкрдпреЛрдЧ: рд╕реНрдерд╛рдиреАрдп рд╕реНрддрд░ рдкрд░ рдЦреЗрддреА рд╡ рд╕реАрдорд┐рдд рджреВрдзред\nтАв рд╡рд┐рд╢реЗрд╖рддрд╛: рдордзреНрдпрдо рдЖрдХрд╛рд░, рд╕рд╣рдирд╢реАрд▓ рд╡ рд╕реНрдерд╛рдиреАрдп рд░реЛрдЧреЛрдВ рдХреЗ рдкреНрд░рддрд┐ рдЕрдиреБрдХреВрд▓ред",
    "Khillari":
    "ЁЯРД рдЦрд┐рд▓реНрд▓рд╛рд░реА рдЧрд╛рдп\nтАв рдореБрдЦреНрдп рдХреНрд╖реЗрддреНрд░: рдорд╣рд╛рд░рд╛рд╖реНрдЯреНрд░ (рд╕рд╛рддрд╛рд░рд╛, рд╕рд╛рдВрдЧрд▓реА, рд╕реЛрд▓рд╛рдкреБрд░, рдЕрд╣рдорджрдирдЧрд░) рд╡ рдХрд░реНрдирд╛рдЯрдХ рд╕реАрдорд╛ред\nтАв рдЙрдкрдпреЛрдЧ: рддреЗрдЬ рдмреИрд▓ рд╢рдХреНрддрд┐, рд╣рд▓ рдПрд╡рдВ рдЧрд╛рдбрд╝реА рдХреЗ рд▓рд┐рдП рдкреНрд░рд╕рд┐рджреНрдзред\nтАв рд╡рд┐рд╢реЗрд╖рддрд╛: рдкрддрд▓рд╛ рд▓реЗрдХрд┐рди рдорд╛рдВрд╕рд▓ рд╢рд░реАрд░, рд╣рд▓реНрдХрд╛ рдЧреНрд░реЗ/рд╕рдлреЗрдж рд░рдВрдЧ, рддреЗрдЬ рдЪрд╛рд▓ред",
    "Krishna_Valley":
    "ЁЯРД рдХреГрд╖реНрдгрд╛ рд╡реИрд▓реА рдЧрд╛рдп\nтАв рдореБрдЦреНрдп рдХреНрд╖реЗрддреНрд░: рдХрд░реНрдирд╛рдЯрдХ рд╡ рдорд╣рд╛рд░рд╛рд╖реНрдЯреНрд░ рдХреА рдХреГрд╖реНрдгрд╛ рдирджреА рдШрд╛рдЯреАред\nтАв рдЙрдкрдпреЛрдЧ: рджреЛрд╣рд░реЗ рдЙрджреНрджреЗрд╢реНрдп тАУ рдЦреЗрддреА рд╡ рджреВрдз рдЙрддреНрдкрд╛рджрдиред\nтАв рд╡рд┐рд╢реЗрд╖рддрд╛: рдЧреНрд░реЗ рд╕реЗ рд╕рдлреЗрдж рд░рдВрдЧ, рдордЬрдмреВрдд рд╢рд░реАрд░, рдирдореА рд╡рд╛рд▓реА рдЧрд░реНрдо рдЬрд▓рд╡рд╛рдпреБ рдореЗрдВ рднреА рдЕрдЪреНрдЫреАред",
    "Malnad_gidda":
    "ЁЯРД рдорд▓рдирд╛рдб рдЧрд┐рдбреНрдбрд╛ рдЧрд╛рдп\nтАв рдореБрдЦреНрдп рдХреНрд╖реЗрддреНрд░: рдХрд░реНрдирд╛рдЯрдХ рдХрд╛ рдорд▓рдирд╛рдб (рдкрд╢реНрдЪрд┐рдореА рдШрд╛рдЯ)\nтАв рдЙрдкрдпреЛрдЧ: рдЫреЛрдЯрд╛ рдЖрдХрд╛рд░, рдШрд░реЗрд▓реВ рджреВрдз, рдЬреИрд╡рд┐рдХ рдЦреЗрддреА рд╡ рдЧреЛрдореВрддреНрд░ рдЖрджрд┐ рдХреЗ рд▓рд┐рдПред\nтАв рд╡рд┐рд╢реЗрд╖рддрд╛: рдмрд╣реБрдд рдЫреЛрдЯреА (рдбреНрд╡рд╛рд░реНрдл) рд▓реЗрдХрд┐рди рдлреБрд░реНрддреАрд▓реА, рдЬрдВрдЧрд▓ рд╡ рдкрд╣рд╛рдбрд╝реА рдЪрд░рд╛рдИ рдХреЗ рд▓рд┐рдП рдЙрдкрдпреБрдХреНрдд, рдХрдо рдЪрд╛рд░реЗ рдореЗрдВ рднреА рдЯрд┐рдХрд╛рдКред",
    "Mehsana":
    "ЁЯРГ рдореЗрд╣рд╕рд╛рдгрд╛ рднреИрдВрд╕\nтАв рдореБрдЦреНрдп рдХреНрд╖реЗрддреНрд░: рдЧреБрдЬрд░рд╛рдд (рдореЗрд╣рд╕рд╛рдгрд╛, рд╕рд╛рдмрд░рдХрд╛рдВрдард╛)\nтАв рдЙрдкрдпреЛрдЧ: рдЕрдЪреНрдЫреА рджреВрдз рджреЗрдиреЗ рд╡рд╛рд▓реА рдорд┐рд╢реНрд░рд┐рдд рдирд╕реНрд▓ (рд╕реБрд░рддреА x рдореБрд░реНрд░рд╛ рдкреНрд░рдХрд╛рд░)ред\nтАв рд╡рд┐рд╢реЗрд╖рддрд╛: рдХрд╛рд▓реЗ рд░рдВрдЧ рдХреЗ рд╕рд╛рде рд╣рд▓реНрдХреЗ рдирд┐рд╢рд╛рди, рджреВрдз рд╡ рдкреНрд░рдЬрдирди рджреЛрдиреЛрдВ рдореЗрдВ рдЕрдЪреНрдЫрд╛ рдкреНрд░рджрд░реНрд╢рдиред",
    "Murrah":
    "ЁЯРГ рдореБрд░реНрд░рд╛ рднреИрдВрд╕\nтАв рдореБрдЦреНрдп рдХреНрд╖реЗрддреНрд░: рд╣рд░рд┐рдпрд╛рдгрд╛, рдкрдВрдЬрд╛рдм, рджрд┐рд▓реНрд▓реА рд╡ рдЙрддреНрддрд░ рднрд╛рд░рдд\nтАв рдЙрдкрдпреЛрдЧ: рднрд╛рд░рдд рдХреА рд╕рдмрд╕реЗ рдкреНрд░рд╕рд┐рджреНрдз рджреБрдЧреНрдз рднреИрдВрд╕ рдирд╕реНрд▓реЛрдВ рдореЗрдВ рд╕реЗ рдПрдХред\nтАв рд╡рд┐рд╢реЗрд╖рддрд╛: рдЬреЗрдЯ рдХрд╛рд▓рд╛ рд░рдВрдЧ, рдЧреЛрд▓ рд╡ рдШреБрдорд╛рд╡рджрд╛рд░ рдЫреЛрдЯреЗ рд╕реАрдВрдЧ, рдЙрдЪреНрдЪ рдлреИрдЯ рд╡рд╛рд▓рд╛ рджреВрдз (рдФрд╕рддрди 8% рдпрд╛ рдЕрдзрд┐рдХ), рдкреВрд░реЗ рднрд╛рд░рдд рдореЗрдВ рдХреНрд░реЙрд╕рдмреНрд░реАрдбрд┐рдВрдЧ рдХреЗ рд▓рд┐рдП рдЙрдкрдпреЛрдЧред",
    "Nagori":
    "ЁЯРД рдирд╛рдЧреМрд░реА рдЧрд╛рдп\nтАв рдореБрдЦреНрдп рдХреНрд╖реЗрддреНрд░: рд░рд╛рдЬрд╕реНрдерд╛рди (рдирд╛рдЧреМрд░ рдХреНрд╖реЗрддреНрд░)\nтАв рдЙрдкрдпреЛрдЧ: рддреЗрдЬ рдмреИрд▓рдЧрд╛рдбрд╝реА рд╡ рдЦреЗрддреА рдХреЗ рд▓рд┐рдП рдкреНрд░рд╕рд┐рджреНрдзред\nтАв рд╡рд┐рд╢реЗрд╖рддрд╛: рд╣рд▓реНрдХрд╛ рд╕рдлреЗрдж/рдЧреНрд░реЗ рд░рдВрдЧ, рд▓рдВрдмрд╛ рд╢рд░реАрд░, рддреЗрдЬ рдЪрд╛рд▓, рд╕реВрдЦреЗ рд╡ рдЧрд░реНрдо рдХреНрд╖реЗрддреНрд░реЛрдВ рдХреЗ рд▓рд┐рдП рдЙрдкрдпреБрдХреНрддред",
    "Nagpuri":
    "ЁЯРГ рдирд╛рдЧрдкреБрд░реА рднреИрдВрд╕\nтАв рдореБрдЦреНрдп рдХреНрд╖реЗрддреНрд░: рдорд╣рд╛рд░рд╛рд╖реНрдЯреНрд░ (рд╡рд┐рджрд░реНрдн рдХреНрд╖реЗрддреНрд░, рд╡рд┐рд╢реЗрд╖рдХрд░ рдирд╛рдЧрдкреБрд░)\nтАв рдЙрдкрдпреЛрдЧ: рджреВрдз рд╡ рдмреИрд▓ рд╢рдХреНрддрд┐ рджреЛрдиреЛрдВред\nтАв рд╡рд┐рд╢реЗрд╖рддрд╛: рд▓рдВрдмреЗ, рддрд▓рд╡рд╛рд░ рдЬреИрд╕реЗ рд╕реАрдВрдЧ, рдХрд╛рд▓рд╛ рдпрд╛ рдЧрд╣рд░рд╛ рднреВрд░рд╛ рд░рдВрдЧ, рдЧрд░реНрдореА рдХреЗ рдкреНрд░рддрд┐ рд╕рд╣рдирд╢реАрд▓ред",
    "Nili_Ravi":
    "ЁЯРГ рдиреАрд▓реА-рд░рд╡рд┐ рднреИрдВрд╕\nтАв рдореБрдЦреНрдп рдХреНрд╖реЗрддреНрд░: рдкрдВрдЬрд╛рдм (рднрд╛рд░рдд-рдкрд╛рдХ рд╕реАрдорд╛ рдХреНрд╖реЗрддреНрд░)\nтАв рдЙрдкрдпреЛрдЧ: рдЙрдЪреНрдЪ рджреВрдз рдЙрддреНрдкрд╛рджрдХ рднреИрдВрд╕ рдирд╕реНрд▓ред\nтАв рд╡рд┐рд╢реЗрд╖рддрд╛: рдЧрд╣рд░рд╛ рдХрд╛рд▓рд╛ рд░рдВрдЧ, рд╕рдлреЗрдж рдирд┐рд╢рд╛рди (chevron) рдорд╛рдереЗ рдкрд░, рдмрдбрд╝реЗ рдЖрдХрд╛рд░ рдХрд╛ рд╢рд░реАрд░, рдЙрдЪреНрдЪ рдлреИрдЯ рджреВрдзред",
    "Nimari":
    "ЁЯРД рдирд┐рдорд╛рдбрд╝реА рдЧрд╛рдп\nтАв рдореБрдЦреНрдп рдХреНрд╖реЗрддреНрд░: рдордзреНрдп рдкреНрд░рджреЗрд╢ рдХрд╛ рдирд░реНрдорджрд╛ рдШрд╛рдЯреА рдХреНрд╖реЗрддреНрд░ред\nтАв рдЙрдкрдпреЛрдЧ: рд╣рд▓ рдХрд╛рд░реНрдп рдФрд░ рд╕реАрдорд┐рдд рджреВрдз рдЙрддреНрдкрд╛рджрдиред\nтАв рд╡рд┐рд╢реЗрд╖рддрд╛: рд▓рд╛рд▓/рднреВрд░реЗ рд░рдВрдЧ рдХреА, рд╕реНрдерд╛рдиреАрдп рдЬрд▓рд╡рд╛рдпреБ рдХреЗ рдЕрдиреБрдХреВрд▓, рдХрдо рджреЗрдЦрднрд╛рд▓ рдореЗрдВ рдЪрд▓рддреА рд╣реИред",
    "Ongole":
    "ЁЯРД рдУрдВрдЧреЛрд▓ рдЧрд╛рдп\nтАв рдореБрдЦреНрдп рдХреНрд╖реЗрддреНрд░: рдЖрдВрдзреНрд░ рдкреНрд░рджреЗрд╢ (рдУрдВрдЧреЛрд▓ рдХреНрд╖реЗрддреНрд░)\nтАв рдЙрдкрдпреЛрдЧ: рдордЬрдмреВрдд рдмреИрд▓, рдирд┐рд░реНрдпрд╛рдд рдХреЗ рд▓рд┐рдП рднреА рдкреНрд░рд╕рд┐рджреНрдз, рдордзреНрдпрдо рджреВрдзред\nтАв рд╡рд┐рд╢реЗрд╖рддрд╛: рд╕рдлреЗрдж/рдЧреНрд░реЗ рд░рдВрдЧ, рдмрдбрд╝рд╛ рд╢рд░реАрд░, рдордЬрдмреВрдд рдХреБрдмрдбрд╝, рдЙрд╖реНрдгрдХрдЯрд┐рдмрдВрдзреАрдп рдХреНрд╖реЗрддреНрд░реЛрдВ рдХреЗ рд▓рд┐рдП рдЙрддреНрддрдоред",
    "Pulikulam":
    "ЁЯРД рдкреБрд▓реАрдХреБрд▓рдо рдЧрд╛рдп\nтАв рдореБрдЦреНрдп рдХреНрд╖реЗрддреНрд░: рддрдорд┐рд▓рдирд╛рдбреБ (рдорджреБрд░реИ, рд╡рд┐рд░реБрдзреБрдирдЧрд░)\nтАв рдЙрдкрдпреЛрдЧ: рдкрд░рдВрдкрд░рд╛рдЧрдд рдЬрд▓реАрдХрдЯреНрдЯреВ рдЦреЗрд▓, рд╣рд▓ рдХрд╛рд░реНрдпред\nтАв рд╡рд┐рд╢реЗрд╖рддрд╛: рдлреБрд░реНрддреАрд▓реА, рддреЗрдЬ, рдЫреЛрдЯреА-рдордзреНрдпрдо, рдЖрдХреНрд░рд╛рдордХ рд╕реНрд╡рднрд╛рд╡, рд╕реНрдерд╛рдиреАрдп рдЪрд░рд╛рдИ рдХреЗ рд▓рд┐рдП рд╕рдХреНрд╖рдоред",
    "Rathi":
    "ЁЯРД рд░рд╛рдареА рдЧрд╛рдп\nтАв рдореБрдЦреНрдп рдХреНрд╖реЗрддреНрд░: рд░рд╛рдЬрд╕реНрдерд╛рди (рдмреАрдХрд╛рдиреЗрд░, рдЧрдВрдЧрд╛рдирдЧрд░)\nтАв рдЙрдкрдпреЛрдЧ: рдкреНрд░рдореБрдЦ рднрд╛рд░рддреАрдп рджреБрдЧреНрдз рдирд╕реНрд▓реЛрдВ рдореЗрдВ рд╕реЗ рдПрдХред\nтАв рд╡рд┐рд╢реЗрд╖рддрд╛: рд▓рд╛рд▓/рднреВрд░реЗ рд░рдВрдЧ рдкрд░ рд╕рдлреЗрдж рдЪрд┐рддреНрддреА рдпрд╛ рд╕рдлреЗрдж рдкрд░ рднреВрд░реЗ рдзрдмреНрдмреЗ, рдЧрд░реНрдореА рд╡ рд╕реВрдЦреЗ рдХреНрд╖реЗрддреНрд░реЛрдВ рдореЗрдВ рднреА рдЕрдЪреНрдЫрд╛ рджреВрдзред",
    "Red_Dane":
    "ЁЯРД рд░реЗрдб рдбреЗрди (рд╡рд┐рджреЗрд╢реА)\nтАв рдореВрд▓: рдбреЗрдирдорд╛рд░реНрдХ\nтАв рдЙрдкрдпреЛрдЧ: рдбреЗрдпрд░реА рдирд╕реНрд▓, рджреВрдз рдЙрддреНрдкрд╛рджрди рдХреЗ рд▓рд┐рдПред\nтАв рд╡рд┐рд╢реЗрд╖рддрд╛: рд▓рд╛рд▓ рдпрд╛ рд▓рд╛рд▓-рднреВрд░рд╛ рд░рдВрдЧ, рд╡рд┐рджреЗрд╢реА рдХреНрд░реЙрд╕рдмреНрд░реАрдб рдореЗрдВ рдкреНрд░рдпреЛрдЧред",
    "Red_Sindhi":
    "ЁЯРД рд░реЗрдб рд╕рд┐рдВрдзреА рдЧрд╛рдп\nтАв рдореБрдЦреНрдп рдХреНрд╖реЗрддреНрд░: рдореВрд▓ рд░реВрдк рд╕реЗ рд╕рд┐рдВрдз (рдЕрдм рдкрд╛рдХрд┐рд╕реНрддрд╛рди), рднрд╛рд░рдд рдореЗрдВ рднреА рд╡реНрдпрд╛рдкрдХред\nтАв рдЙрдкрдпреЛрдЧ: рдЕрдЪреНрдЫреА рджреБрдЧреНрдз рдирд╕реНрд▓, рдХреНрд░реЙрд╕рдмреНрд░реАрдбрд┐рдВрдЧ рдореЗрдВ рднреА рдЙрдкрдпреЛрдЧред\nтАв рд╡рд┐рд╢реЗрд╖рддрд╛: рдЧрд╣рд░рд╛ рд▓рд╛рд▓/рддрд╛рдВрдмрдИ рд░рдВрдЧ, рдордзреНрдпрдо рдЖрдХрд╛рд░, рдЧрд░реНрдореА рд╡ рд░реЛрдЧреЛрдВ рдХреЗ рдкреНрд░рддрд┐ рд╕рд╣рдирд╢реАрд▓ред",
    "Sahiwal":
    "ЁЯРД рд╕рд╛рд╣рд┐рд╡рд╛рд▓ рдЧрд╛рдп\nтАв рдореБрдЦреНрдп рдХреНрд╖реЗрддреНрд░: рдореВрд▓ рд░реВрдк рд╕реЗ рдкрд╛рдХрд┐рд╕реНрддрд╛рди рдХрд╛ рд╕рд╛рд╣рд┐рд╡рд╛рд▓ рдХреНрд╖реЗрддреНрд░; рднрд╛рд░рдд рдореЗрдВ рдкрдВрдЬрд╛рдм, рд╣рд░рд┐рдпрд╛рдгрд╛, рдЙрддреНрддрд░рдкреНрд░рджреЗрд╢, рд░рд╛рдЬрд╕реНрдерд╛рди рдореЗрдВ рд▓реЛрдХрдкреНрд░рд┐рдпред\nтАв рдЙрдкрдпреЛрдЧ: рднрд╛рд░рдд рдХреА рд╕рд░реНрд╡рд╢реНрд░реЗрд╖реНрда рджреБрдЧреНрдз рджреЗрд╢реА рдирд╕реНрд▓реЛрдВ рдореЗрдВ рд╕реЗ рдПрдХ (A2 рджреВрдз)ред\nтАв рд╡рд┐рд╢реЗрд╖рддрд╛: рд▓рд╛рд▓-рднреВрд░рд╛ рд░рдВрдЧ, рд╣рд▓реНрдХреЗ рд╕рдлреЗрдж рдзрдмреНрдмреЗ, рд╢рд╛рдВрдд рд╕реНрд╡рднрд╛рд╡, рдЧрд░реНрдореА рд╕рд╣рдирд╢реАрд▓, рдФрд╕рдд 8тАУ12 рд▓реАрдЯрд░/рджрд┐рди рджреВрдз, рдЕрдЪреНрдЫреА рджреЗрдЦрднрд╛рд▓ рдкрд░ рдФрд░ рдЕрдзрд┐рдХред",
    "Surti":
    "ЁЯРГ рд╕реБрд░рддреА рднреИрдВрд╕\nтАв рдореБрдЦреНрдп рдХреНрд╖реЗрддреНрд░: рдЧреБрдЬрд░рд╛рдд (рд╕реВрд░рдд, рдирд╡рд░рд╕рд╛рд░реА)\nтАв рдЙрдкрдпреЛрдЧ: рдордзреНрдпрдо рджреВрдз рдЙрддреНрдкрд╛рджрди, рдЕрдЪреНрдЫрд╛ рдлреИрдЯ рдкреНрд░рддрд┐рд╢рддред\nтАв рд╡рд┐рд╢реЗрд╖рддрд╛: рд╣рд▓реНрдХреЗ рдореЗрд╣рд░рд╛рдмрджрд╛рд░ рд╕реАрдВрдЧ, рдордзреНрдпрдо рдЖрдХрд╛рд░, рд╢рд╛рдВрдд рд╕реНрд╡рднрд╛рд╡ред",
    "Tharparkar":
    "ЁЯРД рдерд╛рд░рдкрд╛рд░рдХрд░ рдЧрд╛рдп\nтАв рдореБрдЦреНрдп рдХреНрд╖реЗрддреНрд░: рдерд╛рд░ рдорд░реБрд╕реНрдерд▓ (рд░рд╛рдЬрд╕реНрдерд╛рди) рд╡ рд╕рд┐рдВрдз рдХреНрд╖реЗрддреНрд░ред\nтАв рдЙрдкрдпреЛрдЧ: рджреБрдЧреНрдз рд╡ рдмреИрд▓ рд╢рдХреНрддрд┐ рджреЛрдиреЛрдВ рдХреЗ рд▓рд┐рдПред\nтАв рд╡рд┐рд╢реЗрд╖рддрд╛: рд╕рдлреЗрдж/рд╕рд┐рд▓реНрд╡рд░ рдЧреНрд░реЗ рд░рдВрдЧ, рд╕реВрдЦрд╛ рд╡ рдЧрд░реНрдо рдХреНрд╖реЗрддреНрд░ рд╕рд╣рдирд╢реАрд▓, рдордзреНрдпрдо рд╕реЗ рдЕрдЪреНрдЫрд╛ рджреВрдзред",
    "Toda":
    "ЁЯРД рдЯреЛрдбрд╛ рдЧрд╛рдп\nтАв рдореБрдЦреНрдп рдХреНрд╖реЗрддреНрд░: рддрдорд┐рд▓рдирд╛рдбреБ рдХреЗ рдиреАрд▓рдЧрд┐рд░рд┐ рдкрд╣рд╛рдбрд╝реЛрдВ рдореЗрдВ рдЯреЛрдбрд╛ рдЬрдирдЬрд╛рддрд┐ рдХреЗ рдмреАрдЪред\nтАв рдЙрдкрдпреЛрдЧ: рдкрд░рдВрдкрд░рд╛рдЧрдд, рдзрд╛рд░реНрдорд┐рдХ рд╡ рджреВрдз рдЙрдкрдпреЛрдЧред\nтАв рд╡рд┐рд╢реЗрд╖рддрд╛: рдЕрдиреЛрдЦрд╛ рд░рдВрдЧ рдкреИрдЯрд░реНрди, рдШреБрдорд╛рд╡рджрд╛рд░ рд╕реАрдВрдЧ, рдЫреЛрдЯрд╛ рд▓реЗрдХрд┐рди рд╕реБрдВрджрд░ рд╢рд░реАрд░ред",
    "Umblachery":
    "ЁЯРД рдЙрдореНрдмрд▓рд╛рдЪреЗрд░реА рдЧрд╛рдп\nтАв рдореБрдЦреНрдп рдХреНрд╖реЗрддреНрд░: рддрдорд┐рд▓рдирд╛рдбреБ (рддрдВрдЬрд╛рд╡реБрд░, рдирд╛рдЧрдкрдЯреНрдЯрд┐рдирдо)\nтАв рдЙрдкрдпреЛрдЧ: рд╣рд▓ рд╡ рдзрд╛рди рдХреЗ рдЦреЗрддреЛрдВ рдореЗрдВ рдХрд╛рдо, рдереЛрдбрд╝рд╛ рджреВрдзред\nтАв рд╡рд┐рд╢реЗрд╖рддрд╛: рдЧреНрд░реЗ рд╕реЗ рд╕рдлреЗрдж рд░рдВрдЧ, рджрдорджрд╛рд░ рд╢рд░реАрд░, рдЧреАрд▓реА рдорд┐рдЯреНрдЯреА рдореЗрдВ рдХрд╛рдо рдХрд░рдиреЗ рдХреА рдХреНрд╖рдорддрд╛ред",
    "Vechur":
    "ЁЯРД рд╡реЗрдЪреВрд░ рдЧрд╛рдп\nтАв рдореБрдЦреНрдп рдХреНрд╖реЗрддреНрд░: рдХреЗрд░рд▓ (рд╡реЗрдЪреВрд░ рдХреНрд╖реЗрддреНрд░)\nтАв рдЙрдкрдпреЛрдЧ: рдШрд░ рдХреЗ рд▓рд┐рдП рдХрдо рдорд╛рддреНрд░рд╛ рдореЗрдВ рд▓реЗрдХрд┐рди рдкреМрд╖реНрдЯрд┐рдХ A2 рджреВрдзред\nтАв рд╡рд┐рд╢реЗрд╖рддрд╛: рджреБрдирд┐рдпрд╛ рдХреА рд╕рдмрд╕реЗ рдЫреЛрдЯреА рдЧрд╛рдп рдирд╕реНрд▓реЛрдВ рдореЗрдВ рд╕реЗ рдПрдХ, рдмрд╣реБрдд рдЫреЛрдЯрд╛ рдХрдж, рдХрдо рдЪрд╛рд░реЗ рдореЗрдВ рднреА рдЯрд┐рдХрд╛рдК, рдЧреЛрдмрд░ рд╡ рдЧреЛрдореВрддреНрд░ рдЖрдпреБрд░реНрд╡реЗрджрд┐рдХ рдЙрдкрдпреЛрдЧ рдореЗрдВ рдкреНрд░рд╕рд┐рджреНрдзред",
  };

  @override
  void initState() {
    super.initState();
    loadModelAndLabels();
  }

  Future<void> loadModelAndLabels() async {
    await loadModel();
    await loadLabels();
    setState(() {
      _loading = false;
    });
  }

  Future<void> loadModel() async {
    try {
      _interpreter =
      await Interpreter.fromAsset('assets/ml/breed_model.tflite');
      print('Model loaded successfully');
    } catch (e) {
      print('Failed to load model: $e');
    }
  }

  Future<void> loadLabels() async {
    try {
      final labelsData = await DefaultAssetBundle.of(context)
          .loadString('assets/ml/labels.txt');
      _labels = labelsData.split('\n');
      print('Labels loaded successfully');
    } catch (e) {
      print('Failed to load labels: $e');
    }
  }

  @override
  void dispose() {
    _interpreter?.close();
    super.dispose();
  }

  Future<void> _getImage(ImageSource source) async {
    final picker = ImagePicker();
    final pickedFile = await picker.pickImage(source: source);
    if (pickedFile != null) {
      setState(() {
        _loading = true;
        _image = File(pickedFile.path);
        _output = null;
      });
      classifyImage(_image!);
    }
  }

  Future<void> classifyImage(File imageFile) async {
    if (_interpreter == null || _labels == null) {
      print('Interpreter or labels not initialized.');
      setState(() {
        _loading = false;
      });
      return;
    }
    img.Image? originalImage = img.decodeImage(imageFile.readAsBytesSync());
    if (originalImage == null) return;
    final inputShape = _interpreter!.getInputTensor(0).shape;
    final inputHeight = inputShape[1];
    final inputWidth = inputShape[2];
    img.Image resizedImage =
    img.copyResize(originalImage, width: inputWidth, height: inputHeight);
    var inputBytes = resizedImage.getBytes(order: img.ChannelOrder.rgb);
    var inputAsList = inputBytes.map((byte) => byte / 255.0).toList();
    final input = [
      List.generate(inputHeight, (y) => List.generate(inputWidth, (x) {
        final pixelIndex = (y * inputWidth + x) * 3;
        return [
          inputAsList[pixelIndex],
          inputAsList[pixelIndex + 1],
          inputAsList[pixelIndex + 2],
        ];
      }))
    ];
    final outputShape = _interpreter!.getOutputTensor(0).shape;
    var output =
    List.filled(outputShape.reduce((a, b) => a * b), 0.0).reshape(outputShape);
    _interpreter!.run(input, output);
    setState(() {
      final results = output[0] as List;
      _output = results.map((e) => e as double).toList();
      _loading = false;
    });
  }

  // ЁЯФ╣ Compress + encode image for storing in Firestore
  Future<String> _encodeImageToBase64(File imageFile) async {
    try {
      final bytes = await imageFile.readAsBytes();
      final original = img.decodeImage(bytes);
      if (original == null) return '';

      // resize to keep size small (important for Firestore 1MB limit)
      final resized = img.copyResize(original, width: 512);
      final jpg = img.encodeJpg(resized, quality: 75);
      return base64Encode(jpg);
    } catch (e) {
      print('Error encoding image: $e');
      return '';
    }
  }

  Future<void> _saveToHerd(String label, double confidence) async {
    // ЁЯСЗ Yahan bhi threshold check: low confidence pe DB me save mat karo
    if (confidence < _confidenceThreshold) {
      ScaffoldMessenger.of(context).showSnackBar(
        const SnackBar(
          backgroundColor: Colors.orange,
          content: Text(
            'Image cattle/buffalo jaisi clear nahi hai. Please clearer photo use karein.',
          ),
        ),
      );
      return;
    }

    final user = FirebaseAuth.instance.currentUser;
    if (user == null) {
      ScaffoldMessenger.of(context).showSnackBar(
        const SnackBar(
          content: Text('You must be logged in to save to your herd.'),
        ),
      );
      return;
    }
    if (_image == null) return;

    setState(() {
      _loading = true;
    });

    try {
      final base64Image = await _encodeImageToBase64(_image!);

      if (base64Image.isEmpty) {
        throw Exception('Image encoding failed');
      }

      final herdCollection = FirebaseFirestore.instance
          .collection('users')
          .doc(user.uid)
          .collection('herd');

      await herdCollection.add({
        'name': label,
        'breed': label,
        'confidence': confidence,
        'imageBase64': base64Image, // ЁЯФ┤ image now stored in DB
        'timestamp': FieldValue.serverTimestamp(),
      });

      ScaffoldMessenger.of(context).showSnackBar(
        SnackBar(
          backgroundColor: Colors.green,
          content: Text('$label added to My Herd!'),
        ),
      );
      _reset();
    } catch (e) {
      print('Failed to save to herd: $e');
      ScaffoldMessenger.of(context).showSnackBar(
        const SnackBar(
          backgroundColor: Colors.red,
          content: Text('Error: Could not save animal.'),
        ),
      );
    } finally {
      setState(() {
        _loading = false;
      });
    }
  }

  void _reset() {
    setState(() {
      _image = null;
      _output = null;
    });
  }

  // ЁЯФз Helper: safely fetch breed description (handles trim + case)
  String _getBreedDescription(String rawLabel) {
    final normalized = rawLabel.trim();
    print('Top label from model: "[$normalized]"'); // debug

    // exact match
    if (_breedInfo.containsKey(normalized)) {
      return _breedInfo[normalized]!;
    }

    // case-insensitive match
    final lower = normalized.toLowerCase();
    for (final entry in _breedInfo.entries) {
      if (entry.key.toLowerCase() == lower) {
        return entry.value;
      }
    }

    return 'рдЗрд╕ рдирд╕реНрд▓ рдХреЗ рдмрд╛рд░реЗ рдореЗрдВ рдЬрд╛рдирдХрд╛рд░реА рдЙрдкрд▓рдмреНрдз рдирд╣реАрдВ рд╣реИред\n(Label: $rawLabel)';
  }

  @override
  Widget build(BuildContext context) {
    return Scaffold(
      appBar: AppBar(
        title: const Text('Pashu Scanner'),
        backgroundColor: Theme.of(context).primaryColor,
        foregroundColor: Colors.white,
        elevation: 4,
      ),
      body: _loading
          ? const Center(child: CircularProgressIndicator())
          : Center(
        child: SingleChildScrollView(
          child: Column(
            mainAxisAlignment: MainAxisAlignment.center,
            children: <Widget>[
              if (_image == null)
                _buildInitialView()
              else
                _buildResultView(),
            ],
          ),
        ),
      ),
    );
  }

  Widget _buildInitialView() {
    return Column(
      children: [
        const Icon(Icons.camera_alt_outlined, size: 100, color: Colors.grey),
        const SizedBox(height: 20),
        const Text(
          'Scan an Animal',
          style: TextStyle(fontSize: 24, fontWeight: FontWeight.bold),
        ),
        const SizedBox(height: 10),
        const Text(
          'Use your camera or select a photo from your gallery.',
          textAlign: TextAlign.center,
          style: TextStyle(fontSize: 16, color: Colors.grey),
        ),
        const SizedBox(height: 40),
        ElevatedButton.icon(
          onPressed: () => _getImage(ImageSource.camera),
          icon: const Icon(Icons.camera_alt),
          label: const Text('Take a Photo'),
          style: ElevatedButton.styleFrom(
            minimumSize: const Size(250, 50),
            textStyle: const TextStyle(fontSize: 18),
          ),
        ),
        const SizedBox(height: 16),
        ElevatedButton.icon(
          onPressed: () => _getImage(ImageSource.gallery),
          icon: const Icon(Icons.photo_library),
          label: const Text('Choose from Gallery'),
          style: ElevatedButton.styleFrom(
            minimumSize: const Size(250, 50),
            textStyle: const TextStyle(fontSize: 18),
          ),
        ),
      ],
    );
  }

  Widget _buildResultView() {
    String topLabel = 'Unknown';
    double maxConfidence = 0.0;

    if (_output != null && _labels != null && _output!.isNotEmpty) {
      maxConfidence = _output!.reduce((a, b) => a > b ? a : b);
      int topIndex = _output!.indexOf(maxConfidence);
      if (topIndex < _labels!.length) {
        topLabel = _labels![topIndex];
      }
    }

    final bool isConfident = maxConfidence >= _confidenceThreshold;

    // Agar confidence low hai to breed description mat do, generic warning do
    final String breedDescription = isConfident
        ? _getBreedDescription(topLabel)
        : 'тЪая╕П рдпрд╣ рдлреЛрдЯреЛ рд╕рд╛рдлрд╝ рддреМрд░ рдкрд░ рдЧрд╛рдп рдпрд╛ рднреИрдВрд╕ рдХреА рдирд╣реАрдВ рд▓рдЧ рд░рд╣реА рд╣реИ,\n'
        'рдпрд╛ рдореЙрдбрд▓ рдХреЛ рдкрдХреНрдХрд╛ рднрд░реЛрд╕рд╛ рдирд╣реАрдВ рд╣реИред\n\n'
        'рдХреГрдкрдпрд╛ рд╕рд╛рдордиреЗ рд╕реЗ, рд╕рд╛рдлрд╝ рд░реЛрд╢рдиреА рдореЗрдВ, рдкреВрд░рд╛ рд╕рд┐рд░ рдФрд░ рд╢рд░реАрд░ рджрд┐рдЦреЗ рдРрд╕реА рдлреЛрдЯреЛ рдЦреАрдВрдЪрдХрд░ рджреЛрдмрд╛рд░рд╛ рдкреНрд░рдпрд╛рд╕ рдХрд░реЗрдВред';

    return Column(
      children: [
        Padding(
          padding: const EdgeInsets.all(16.0),
          child: ClipRRect(
            borderRadius: BorderRadius.circular(12.0),
            child: Image.file(_image!),
          ),
        ),
        const SizedBox(height: 20),

        if (_output != null)
          Card(
            elevation: 5,
            margin: const EdgeInsets.symmetric(horizontal: 20),
            shape: RoundedRectangleBorder(
              borderRadius: BorderRadius.circular(12),
            ),
            child: Padding(
              padding: const EdgeInsets.all(16.0),
              child: isConfident
                  ? Column(
                children: [
                  const Text(
                    'Top Prediction',
                    style: TextStyle(
                      fontSize: 18,
                      fontWeight: FontWeight.w500,
                      color: Colors.grey,
                    ),
                  ),
                  const SizedBox(height: 8),
                  Text(
                    topLabel,
                    style: TextStyle(
                      fontSize: 28,
                      fontWeight: FontWeight.bold,
                      color: Theme.of(context).primaryColor,
                    ),
                  ),
                  const SizedBox(height: 8),
                  Text(
                    'Confidence: ${(maxConfidence * 100).toStringAsFixed(2)}%',
                    style: const TextStyle(fontSize: 18),
                  ),
                  const SizedBox(height: 24),
                  ElevatedButton.icon(
                    onPressed: () => _saveToHerd(topLabel, maxConfidence),
                    icon: const Icon(Icons.add_circle_outline),
                    label: const Text('Add to My Herd'),
                    style: ElevatedButton.styleFrom(
                      padding: const EdgeInsets.symmetric(
                        horizontal: 30,
                        vertical: 12,
                      ),
                    ),
                  ),
                ],
              )
                  : Column(
                children: [
                  const Text(
                    'Prediction not reliable',
                    style: TextStyle(
                      fontSize: 18,
                      fontWeight: FontWeight.w600,
                      color: Colors.redAccent,
                    ),
                  ),
                  const SizedBox(height: 8),
                  Text(
                    'Confidence: ${(maxConfidence * 100).toStringAsFixed(2)}%',
                    style: const TextStyle(fontSize: 16),
                  ),
                  const SizedBox(height: 8),
                  const Text(
                    'Model is not confident that this is a cattle/buffalo image.\n'
                        'Please try with a clearer animal photo.',
                    textAlign: TextAlign.center,
                  ),
                ],
              ),
            ),
          ),

        const SizedBox(height: 16),

        // Breed information / warning card
        Card(
          elevation: 3,
          margin: const EdgeInsets.symmetric(horizontal: 20),
          shape: RoundedRectangleBorder(
            borderRadius: BorderRadius.circular(12),
          ),
          child: Padding(
            padding: const EdgeInsets.all(16.0),
            child: Align(
              alignment: Alignment.centerLeft,
              child: Text(
                breedDescription,
                textAlign: TextAlign.start,
                style: const TextStyle(fontSize: 16, height: 1.4),
              ),
            ),
          ),
        ),

        const SizedBox(height: 20),
        TextButton.icon(
          onPressed: _reset,
          icon: const Icon(Icons.refresh),
          label: const Text('Scan Another Image'),
        ),
        const SizedBox(height: 20),
      ],
    );
  }
}
